"use strict";angular.module("ngNestedResource",["ngResource"]),angular.module("ngNestedResource").factory("BaseCollection",function(){var t=function(t,e,r,a){this.model=t,this.queryParams={},this.page=r?r:1,this.perPage=e?e:20,this.totalItems,this.totalPages,this.pages=[],this.endReached=!1,this.paginatedObjectProperties=angular.extend({totalItems:"total",totalPages:"last_page",data:"data"},a)};return t.prototype=new Array,t.prototype.fetch=function(t,e,r){var a=this;return this.model.list(t,e,r).then(function(t){return a.clear(),t&&t.hasOwnProperty(a.paginatedObjectProperties.data)&&(a.totalItems=t[a.paginatedObjectProperties.totalItems],a.totalPages=t[a.paginatedObjectProperties.totalPages],angular.forEach(t[a.paginatedObjectProperties.data],function(e,r){t[a.paginatedObjectProperties.data][r]=new a.model(e)}),t=t[a.paginatedObjectProperties.data]),angular.forEach(t,function(t){a.push(t)}),a})},t.prototype.populate=function(t){var e=this;return e.clear(),t.forEach(function(t){e.push(new e.model(t))}),e},t.prototype.loadMore=function(t,e,r){if(this.allLoaded())return this;var a=this;return this.queryParams.take=t?t:this.perPage,this.queryParams.skip=this.length,this.model.list(this.queryParams,e,r).then(function(t){return t.length<a.queryParams.take&&(a.endReached=!0),angular.forEach(t,function(t){a.push(t)}),a})},t.prototype.query=function(t,e,r){var a=this;return a.queryParams=t?t:{},a.queryParams.skip=0,a.queryParams.take||(a.queryParams.take=a.perPage),a.fetch(a.queryParams,e,r)},t.prototype.filter=function(t,e,r){var a=this;return a.queryParams.skip=0,a.queryParams.take||(a.queryParams.take=a.perPage),angular.extend(a.queryParams,t),a.fetch(a.queryParams,e,r)},t.prototype.clear=function(){for(;this.length>0;)this.pop();this.endReached=!1},t.prototype.allLoaded=function(){return angular.isUndefined(this.queryParams.take)||this.queryParams.take>this.length||this.endReached},t.prototype.count=function(t,e){var r=this;return this.model.count(this.queryParams,function(t){for(r.totalItems=t,r.totalPages=r.totalItems>=r.perPage?parseInt(r.totalItems/r.perPage):1,r.pages=[],i=1;i<=r.totalPages;i++)r.pages.push({number:i,text:i});return t})},t.prototype.selectPage=function(t,e,r,a){if(!(t>this.totalPages||1>t)){e&&(this.queryParams=e);var n=this;return this.queryParams.take=this.perPage,this.queryParams.skip=(t-1)*this.perPage,this.queryParams.page=t,this.page=t,n.fetch(n.queryParams,r,a)}},t.prototype.noPrevious=function(){return 1===this.page},t.prototype.noNext=function(){return this.page===this.totalPages},t.prototype.remove=function(t){var e=-1;angular.forEach(this,function(r,a){-1==e&&r.id==t.id&&(e=a)}),e>-1&&this.splice(e,1),t.destroy()},function(e){var r=function(r,a){return new t(e,r,a)};return r.prototype=t.prototype,r.model=e,r}}),angular.module("ngNestedResource").factory("BaseModel",["$resource","$injector","$http",function(t,e,r){return function(a,n,o,s,i){s=s||{},i=i||"data";var u=t(a,n,angular.extend({_list:{method:"GET",isArray:!0},_store:{method:"POST"},_update:{method:"PUT"},_destroy:{method:"DELETE"}},s)),p=function(t){return angular.forEach(o,function(r,a){if(!angular.isUndefined(t[a])){var n=e.get(r);angular.isArray(t[a])?"undefined"!=typeof n.model?t[a]=(new n).populate(t[a]):angular.forEach(t[a],function(e,r){t[a][r]=new n(e)}):t[a]=new n(t[a])}}),t};u.prototype.store=function(t,e){return this.$_store({},t,e).then(function(t){return p(t)})},u.prototype.update=function(t,e){return this.$_update({},t,e).then(function(t){return p(t)})},u.prototype.save=function(t,e){return this.id?this.update(t,e):this.store(t,e)},u.prototype["delete"]=function(t,e){return this.$_destroy({},t,e).then(function(t){return p(t)})},u.prototype.destroy=function(t,e){return this.$_destroy({},t,e)},u.prototype.clone=function(){var t=new u(angular.copy(this));return p(t)},u.prototype.isStored=function(){return!angular.isUndefined(this.id)};var c=function(t){return this.instance=new u(t),p(this.instance)};return c.list=function(t,e,r){var a=this;return u._list(t,null,e,r).$promise.then(function(t){return Array.isArray(t)?angular.forEach(t,function(e,r){t[r]=p(e)}):angular.forEach(t[i],function(e,r){t[i][r]=new a(e)}),t})},c.get=function(t,e,r){return u.get(t,null,e,r).$promise.then(function(t){return p(t)})},c.count=function(t,e,n){return r({url:a.replace(":id","")+"count",method:"GET",params:t}).success(e).error(n)},c.prototype=u.prototype,c.resource=u,c}}]);