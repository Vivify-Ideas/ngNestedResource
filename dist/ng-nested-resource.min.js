"use strict";angular.module("ngNestedResource",["ngResource"]),angular.module("ngNestedResource").factory("BaseCollection",function(){var t=function(t,e,r){this.model=t,this.queryParams={},this.page=r?r:1,this.perPage=e?e:20,this.totalItems,this.totalPages,this.pages=[],this.endReached=!1};return t.prototype=new Array,t.prototype.populate=function(t){var e=this;return e.clear(),t.forEach(function(t){e.push(new e.model(t))}),e},t.prototype.loadMore=function(t,e,r){if(this.allLoaded())return this;var a=this;return this.queryParams.take=t?t:this.perPage,this.queryParams.skip=this.length,this.model.list(this.queryParams,e,r).then(function(t){return t.length<a.queryParams.take&&(a.endReached=!0),angular.forEach(t,function(t){a.push(t)}),a})},t.prototype.query=function(t,e,r){var a=this;return a.queryParams=t?t:{},a.queryParams.skip=0,a.queryParams.take||(a.queryParams.take=a.perPage),this.model.list(a.queryParams,e,r).then(function(t){return a.clear(),t&&t.hasOwnProperty("data")&&(a.totalItems=t.totalItems,a.totalPages=t.totalPages,t=t.data),angular.forEach(t,function(t){a.push(t)}),a})},t.prototype.filter=function(t,e,r){var a=this;return a.queryParams.skip=0,a.queryParams.take||(a.queryParams.take=a.perPage),angular.extend(a.queryParams,t),this.model.list(a.queryParams,e,r).then(function(t){return a.clear(),angular.forEach(t,function(t){a.push(t)}),a})},t.prototype.clear=function(){for(;this.length>0;)this.pop();this.endReached=!1},t.prototype.allLoaded=function(){return angular.isUndefined(this.queryParams.take)||this.queryParams.take>this.length||this.endReached},t.prototype.count=function(t,e){var r=this;return this.model.count(this.queryParams,function(t){for(r.totalItems=t,r.totalPages=r.totalItems>=r.perPage?parseInt(r.totalItems/r.perPage):1,r.pages=[],i=1;i<=r.totalPages;i++)r.pages.push({number:i,text:i});return t})},t.prototype.selectPage=function(t,e,r,a){if(!(t>this.totalPages||1>t)){e&&(this.queryParams=e);var n=this;return this.queryParams.take=this.perPage,this.queryParams.skip=(t-1)*this.perPage,this.page=t,this.model.list(this.queryParams,r,a).then(function(t){return n.clear(),angular.forEach(t,function(t){n.push(t)}),n})}},t.prototype.noPrevious=function(){return 1===this.page},t.prototype.noNext=function(){return this.page===this.totalPages},t.prototype.remove=function(t){var e=-1;angular.forEach(this,function(r,a){-1==e&&r.id==t.id&&(e=a)}),e>-1&&this.splice(e,1),t.destroy()},function(e){var r=function(r,a){return new t(e,r,a)};return r.prototype=t.prototype,r.model=e,r}}),angular.module("ngNestedResource").factory("BaseModel",["$resource","$injector","$http",function(t,e,r){return function(a,n,o,s,u){s=s||{},u=u||{},u=angular.extend({totalItems:"total",totalPages:"last_page",data:"data"},u);var i=t(a,n,angular.extend({_list:{method:"GET",isArray:!0},_store:{method:"POST"},_update:{method:"PUT"},_destroy:{method:"DELETE"}},s)),h=function(t){return angular.forEach(o,function(r,a){if(!angular.isUndefined(t[a])){var n=e.get(r);angular.isArray(t[a])?"undefined"!=typeof n.model?t[a]=(new n).populate(t[a]):angular.forEach(t[a],function(e,r){t[a][r]=new n(e)}):t[a]=new n(t[a])}}),t};i.prototype.store=function(t,e){return this.$_store({},t,e).then(function(t){return h(t)})},i.prototype.update=function(t,e){return this.$_update({},t,e).then(function(t){return h(t)})},i.prototype.save=function(t,e){return this.id?this.update(t,e):this.store(t,e)},i.prototype["delete"]=function(t,e){return this.$_destroy({},t,e).then(function(t){return h(t)})},i.prototype.destroy=function(t,e){return this.$_destroy({},t,e)},i.prototype.clone=function(){var t=new i(angular.copy(this));return h(t)},i.prototype.isStored=function(){return!angular.isUndefined(this.id)};var p=function(t){return this.instance=new i(t),h(this.instance)};return p.list=function(t,e,r){return i._list(t,null,e,r).$promise.then(function(t){return t&&t.hasOwnProperty(u.data)?(t.totalItems=t[u.totalItems],t.totalPages=t[u.totalPages],angular.forEach(t[u.data],function(e,r){t.data[r]=h(e)}),t):(angular.forEach(t,function(e,r){t[r]=h(e)}),t)})},p.get=function(t,e,r){return i.get(t,null,e,r).$promise.then(function(t){return h(t)})},p.count=function(t,e,n){return r({url:a.replace(":id","")+"count",method:"GET",params:t}).success(e).error(n)},p.prototype=i.prototype,p.resource=i,p}}]);